<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Promptium｜輕鬆分享提示詞</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+Mono:wght@100..900&family=Noto+Sans+TC:wght@100..900&family=Racing+Sans+One&display=swap"
        rel="stylesheet">
    <link rel="shortcut icon" type="image/x-icon" href="./static/favicon.ico">
    <style>
        * {
            font-family: "Noto Sans Mono", "Noto Sans TC", sans-serif;
        }

        h1 {
            font-family: "Racing Sans One", sans-serif;
            font-weight: 400;
            font-style: normal;
            font-size: 64px;
            user-select: none;
            /* 標準屬性 */
            -webkit-user-select: none;
            /* Safari */
            -moz-user-select: none;
            /* Firefox */
            -ms-user-select: none;
            /* Internet Explorer/Edge */
        }

        p {
            line-height: 1.5 !important;
        }

        /* 新增：當滑鼠懸停在 <a> 標籤時，顯示手形指標 */
        a:hover h1,
        .list-group {
            cursor: pointer;
        }

        /* 可選：改變 <a> 標籤的顏色以符合設計需求 */
        a.text-decoration-none h1 {
            color: inherit;
            /* 繼承父元素的文字顏色 */
        }

        /* 可選：調整預覽框的樣式 */
        .preview-box {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.25rem;
            margin-top: 1rem;
            margin-bottom: 0;
        }

        /* 自動調整 textarea 高度 */
        textarea {
            overflow: hidden;
            resize: none;
            overflow-x: auto !important;
            white-space: pre !important;
            line-height: 1.5 !important;
            /* 移除 height 和 min-height，讓 autosize 控制高度 */
        }

        .form-floating>.form-control:focus~label,
        .form-floating>.form-control:not(:placeholder-shown)~label,
        .form-floating>.form-select~label {
            opacity: .65;
            transform: scale(.60) translateY(-.5rem) translateX(.15rem);
        }

        /* 隱藏置換結果區域 */
        #replacementResultsSection {
            display: none;
        }

        /* 隱藏進階功能區域，使用 Bootstrap 的 collapse */
        /* 無需額外 CSS，Bootstrap 已處理 */
    </style>
</head>

<body>
    <div class="container px-5 pt-5" style="max-width: 56rem; min-height: 102vh;">
        <div class="row mb-4">
            <div class="row mb-4">
                <a href="/" class="text-decoration-none link-dark">
                    <h1 class="text-center no-select">Promptium</h1>
                </a>
            </div>
        </div>
        <div class="row mb-4">
            <h2 class="fs-6 mb-3 fw-bold">如何使用</h2>
            <p>
                使用 Promptium 可以輕鬆的分享提示詞模板，只要輸入提示詞的名稱、說明和模板，並點擊產生分享連結，即可完成分享。更棒的是，啟用 Promptium
                的進階功能後，還能將使用案例一併分享出去。
            </p>
            <p class="m-0">
                <a class="btn btn-dark btn-sm" data-bs-toggle="collapse" href="#collapseExample" role="button"
                    aria-expanded="false" aria-controls="collapseExample">
                    使用範例
                </a>
                <a class="btn btn-dark btn-sm" href="./explore.html" role="button">
                    作者收藏
                </a>
                <a class="btn btn-dark btn-sm" href="./flow.html" role="button">
                    組合提示詞流程
                </a>
            </p>
            <div class="collapse mt-3" id="collapseExample">
                <div class="list-group">
                </div>
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-12">
                <h2 class="fs-6 mb-3 fw-bold">開始製作</h2>
                <div class="form-floating mb-2">
                    <input type="text" class="form-control name-input" id="nameInput1" placeholder="提示詞的名稱"
                        value="翻譯名言佳句">
                    <label for="nameInput1">提示詞的名稱</label>
                </div>
                <!-- 提示詞說明 -->
                <div class="form-floating mb-2">
                    <textarea class="form-control description-textarea" id="descriptionTextarea1"
                        placeholder="提示詞的說明">這是一個翻譯名言佳句的提示詞模板。</textarea>
                    <label for="descriptionTextarea1">提示詞的說明</label>
                </div>
                <!-- 提示詞模板 -->
                <div class="form-floating">
                    <textarea class="form-control template-textarea" id="templateTextarea1" placeholder="提示詞的模板">請將以下名言佳句翻譯為指定語言。
指定語言：[請刪除並替換為指定語言]
名言佳句：[請刪除並替換為名言佳句]</textarea>
                    <label for="templateTextarea1">提示詞的模板</label>
                </div>
            </div>
        </div>
        <div class="row mb-2">
            <div class="col-12 mb-2">
                <button type="button" id="shareButton" class="btn btn-dark w-100">產生分享連結</button>
            </div>
            <div class="col-12">
                <!-- 更新按鈕，添加 Bootstrap 的 Collapse 屬性 -->
                <button type="button" id="advanceButton" class="btn btn-dark w-100" data-bs-toggle="collapse"
                    data-bs-target="#advanceSection" aria-expanded="false" aria-controls="advanceSection">
                    開啟進階功能
                </button>
            </div>
        </div>
        <!-- 更新進階功能區域，添加 collapse 類別 -->
        <div class="row collapse" id="advanceSection">
            <div class="col-12 mb-3">
                <div class="card p-4">
                    <h2 class="fs-6 mb-3 fw-bold">學習使用</h2>
                    <p class="m-0 mb-3">
                        當我們開心的分享提示詞模板時，被分享的人經常無法想像要如何使用，而 Promptium 就是為此誕生。只要依照範例輸入簡化後的 XML
                        標記，點擊按鈕後就會自動產生使用案例（最多 50 筆），點擊測試按鈕後，甚至可以立刻在 ChatGPT 上檢視效果。
                    </p>
                    <!-- 模板置換詞彙 -->
                    <div class="form-floating">
                        <textarea class="form-control vocab-textarea" id="vocabTextarea1" placeholder="模板置換詞彙"
                            style="height: 118px;"></textarea>
                        <label for="vocabTextarea1">模板置換詞彙</label>
                    </div>
                    <!-- 置換結果預覽 -->
                    <div class="preview-box alert alert-secondary pb-0 mb-2 mt-2" role="alert">
                        <h6 class="alert-heading">置換結果預覽</h6>
                        <pre class="preview-text"></pre>
                    </div>
                    <div class="row">
                        <div class="col-12 d-flex gap-2">
                            <button type="button" id="generateNewPreviewButton"
                                class="btn btn-dark w-100">產生隨機預覽</button>
                            <button type="button" id="generateAllPreviewButton"
                                class="btn btn-dark w-100">產生置換結果</button>
                        </div>
                    </div>
                    <div class="row mt-2" id="replacementResultsSection">
                        <div class="col-12" id="replacementResults">
                            <div class="mt-3" id="copyAlert" style="display: none;" class="alert alert-success">
                                已成功複製到剪貼簿！
                            </div>
                            <!-- 置換結果將動態生成於此處 -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <footer class="mt-auto text-white-50 bg-dark text-center d-flex justify-content-center align-items-center"
        style="height: 50px;">
        <a class="mx-2 link-light" target="_blank" href="https://x.com/lloyd3126">
            Made by Chen Chung Nien
        </a>
        <a class="mx-2 link-light" target="_blank" href="https://prompter.fofr.ai/">
            Inspired by @fofrAI
        </a>
        <a class="mx-2 link-light" target="_blank" href="https://buymeacoffee.com/niencc">
            Buy me a coffee
        </a>
    </footer>

    <!-- Modal for Share Link -->
    <div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">提示詞連結</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="關閉"></button>
                </div>
                <div class="modal-body">
                    <p>Promptium 提供用戶以下兩種方式進行分享，編輯連結可以永久保存資料，而分享網址則會不定期刪除非活躍連結。建議用戶妥善保管兩種連結，一旦關閉網站，連結將會被清除。</p>
                    <p class="m-0">編輯連結：</p>
                    <div class="my-3">
                        <textarea class="form-control" id="shareLinkTextarea" readonly
                            style="height: 55px; overflow-y: hidden;"></textarea>
                    </div>
                    <p class="m-0">分享網址：</p>
                    <div class="mt-2">
                        <textarea class="form-control" id="shortShareLinkTextarea" readonly
                            style="height: 30px; overflow-y: hidden;"></textarea>
                    </div>
                    <div class="alert alert-success mt-3" id="shareCopyAlert" style="display:none;">已成功複製連結！</div>
                </div>
                <div class="modal-footer">
                    <button type="button" id="copyShareLinkButton" class="btn btn-dark">複製編輯連結</button>
                    <button type="button" id="copyShortShareLinkTextarea" class="btn btn-dark">複製分享連結</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 引入 autosize 庫 -->
    <script src="https://cdn.jsdelivr.net/npm/autosize@4.0.2/dist/autosize.min.js"></script>
    <script>
        (function () {
            fetch('example.json')
                .then(response => response.json())
                .then(examples => {
                    // 取得 list-group 容器
                    const listGroup = document.querySelector('.list-group');

                    // 取得所有 key 並排序
                    const keys = Object.keys(examples).sort();

                    keys.forEach(key => {

                        const item = examples[key];
                        let { name, advance, prompt, example } = item;

                        if (!example) return

                        const div = document.createElement('div');
                        div.className = 'list-group-item list-group-item-action link-dark';
                        div.textContent = name;

                        div.addEventListener('click', () => {
                            let url;
                            if (advance) {
                                url = `./?advance=true#prompt/${prompt}`;
                            } else {
                                url = `./#prompt/${prompt}`;
                            }
                            // 導向新 URL 後強制重整
                            window.location.href = url;
                        });

                        listGroup.appendChild(div);
                    });
                });
        })();


        /**
         * 函數：處理 URL hash 的變化
         */
        function handleHashChange() {
            decodeFromHash();
        }


        /**
         * 函數：解析 XML 字串為 JSON
         */
        function parseXMLtoJSON(xmlStr) {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(`<root>${xmlStr}</root>`, "application/xml");
            const parserError = xmlDoc.getElementsByTagName("parsererror");
            if (parserError.length > 0) {
                console.error("XML 解析錯誤:", parserError[0].textContent);
                return null;
            }
            const json = {};
            const children = xmlDoc.documentElement.children;
            for (let child of children) {
                const tagName = child.tagName;
                const textContent = child.textContent;
                if (!json[tagName]) {
                    json[tagName] = [];
                }
                json[tagName].push(textContent);
            }
            return json;
        }

        /**
         * 函數：隨機選取陣列中的一個元素
         */
        function getRandomElement(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        /**
         * 函數：替換模板中的佔位符
         */
        function replaceTemplate(template, replacements) {
            let result = template;
            for (let key in replacements) {
                const regex = new RegExp(`<${key}>`, 'g');
                result = result.replace(regex, replacements[key]);
            }
            return result;
        }

        /**
         * 函數：生成所有組合
         */
        function generateAllCombinations(obj) {
            const keys = Object.keys(obj);
            if (keys.length === 0) return [];

            // 使用遞迴生成組合
            const combinations = [];

            function helper(index, current) {
                if (index === keys.length) {
                    combinations.push({ ...current });
                    return;
                }
                const key = keys[index];
                const values = obj[key];
                for (let value of values) {
                    current[key] = value;
                    helper(index + 1, current);
                }
            }

            helper(0, {});
            return combinations;
        }

        /**
         * Base64 編碼：支持中文
         */
        function toBase64(str) {
            return btoa(unescape(encodeURIComponent(str)));
        }

        /**
         * Base64 解碼：與上面配套
         */
        function fromBase64(str) {
            return decodeURIComponent(escape(atob(str)));
        }

        /**
         * 從網址中解碼資料並填入表單
         */
        function decodeFromHash() {
            if (location.hash.startsWith('#prompt/')) {
                const base64 = location.hash.replace('#prompt/', '');
                try {
                    const decodedPrompt = fromBase64(base64);
                    const data = JSON.parse(decodedPrompt);

                    const nameInput = document.getElementById('nameInput1');
                    const descriptionTextarea = document.getElementById('descriptionTextarea1');
                    const templateTextarea = document.getElementById('templateTextarea1');
                    const vocabTextarea = document.getElementById('vocabTextarea1');

                    // 將資料填回表單
                    nameInput.value = data.name || '';
                    descriptionTextarea.value = data.description || '';
                    templateTextarea.value = data.template || '';
                    vocabTextarea.value = data.vocab || '';

                    // 更新 autosize
                    autosize.update(descriptionTextarea);
                    autosize.update(templateTextarea);
                    autosize.update(vocabTextarea);

                    // 觸發一次 input 事件以便更新預覽
                    vocabTextarea.dispatchEvent(new Event('input'));
                } catch (e) {
                    console.error("解碼時發生錯誤: ", e);
                }
            }
        }


        /**
         * 函數：調整 textarea 高度以避免水平捲軸遮擋最後一行文字
         * @param {HTMLTextAreaElement} textarea - 要調整的 textarea 元素
         */
        function adjustHeightForScrollbar(textarea) {
            // 檢查是否有水平捲軸
            if (textarea.scrollWidth > textarea.clientWidth) {
                // 增加固定高度，例如 20px
                const currentHeight = parseFloat(getComputedStyle(textarea).height);
                textarea.style.height = (currentHeight + 20) + 'px';
            } else {
                // 可選：如果不需要，可以重置高度
                // 例如：textarea.style.height = null;
            }
        }

        /**
         * 函數：處理表單的邏輯
         */
        function setupForm() {
            const vocabTextarea = document.getElementById('vocabTextarea1');
            const templateTextarea = document.getElementById('templateTextarea1');
            const previewText = document.querySelector('.preview-text');
            const nameInput = document.getElementById('nameInput1');
            const descriptionTextarea = document.getElementById('descriptionTextarea1');
            const replacementResults = document.getElementById('replacementResults');
            const copyAlert = document.getElementById('copyAlert');

            let vocabJSON = {};

            // 當模板置換詞彙有變動時解析 XML
            vocabTextarea.addEventListener('input', () => {
                const xmlStr = vocabTextarea.value;
                const parsed = parseXMLtoJSON(xmlStr);
                if (parsed) {
                    vocabJSON = parsed;
                    generatePreview();
                } else {
                    vocabJSON = {};
                    previewText.textContent = "XML 解析錯誤，無法生成預覽。";
                }

                // textarea 變動後調整高度
                adjustHeightForScrollbar(vocabTextarea);
            });

            // 當任何 input 或 textarea 有變動時生成預覽並調整高度
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', () => {
                    generatePreview();

                    // 若為 textarea，則在輸入變動後調整高度
                    if (input.tagName.toLowerCase() === 'textarea') {
                        adjustHeightForScrollbar(input);
                    }
                });
            });

            // 函數：生成預覽
            function generatePreview() {
                if (Object.keys(vocabJSON).length === 0) {
                    previewText.textContent = "請輸入有效的模板置換詞彙以生成預覽。";
                    adjustHeightForScrollbar(previewText.parentElement); // 更新預覽區域高度
                    return;
                }
                const replacements = {};
                for (let key in vocabJSON) {
                    replacements[key] = getRandomElement(vocabJSON[key]);
                }
                const template = templateTextarea.value;
                const replaced = replaceTemplate(template, replacements);
                previewText.textContent = replaced;

                // 預覽更新後檢查水平捲軸
                adjustHeightForScrollbar(previewText.parentElement);
            }

            // 使用 autosize 進行自動調整
            const textareas = document.querySelectorAll('textarea');
            autosize(textareas);
            textareas.forEach(textarea => autosize.update(textarea));

            // 初次執行一次調整
            textareas.forEach(textarea => adjustHeightForScrollbar(textarea));

            // 從 hash 載入資料
            decodeFromHash();

            // 手動觸發一次輸入事件以初始化預覽
            vocabTextarea.dispatchEvent(new Event('input'));

            // 為「產生隨機預覽」按鈕添加點擊事件監聽器
            const generateNewPreviewButton = document.getElementById('generateNewPreviewButton');
            generateNewPreviewButton.addEventListener('click', generatePreview);

            // 為「產生置換結果」按鈕添加點擊事件監聽器
            const generateAllPreviewButton = document.getElementById('generateAllPreviewButton');
            generateAllPreviewButton.addEventListener('click', () => {
                if (Object.keys(vocabJSON).length === 0) {
                    alert("請輸入有效的模板置換詞彙以生成置換結果。");
                    return;
                }

                // 計算總組合數量
                const totalCombinations = Object.values(vocabJSON).reduce((acc, arr) => acc * arr.length, 1);
                const maxCombinations = 50;
                let combinations = [];

                if (totalCombinations <= maxCombinations) {
                    // 若組合總數量 <= 50，則直接產生所有組合
                    combinations = generateAllCombinations(vocabJSON);
                } else {
                    // 若組合總數量 > 50，則隨機產生 50 組不重複的組合
                    // 為防止無限迴圈，設定最大嘗試次數為1000次，依需求可自行調整
                    const maxAttempts = 1000;
                    let attempts = 0;
                    while (combinations.length < maxCombinations && attempts < maxAttempts) {
                        attempts++;
                        const combo = {};
                        for (let key in vocabJSON) {
                            combo[key] = getRandomElement(vocabJSON[key]);
                        }

                        // 檢查組合是否已存在
                        const comboStr = JSON.stringify(combo);
                        if (!combinations.some(c => JSON.stringify(c) === comboStr)) {
                            combinations.push(combo);
                        }
                    }

                    // 若嘗試後未滿 50 組，也會停在目前組合數
                }

                // 清空之前的結果
                replacementResults.innerHTML = `
                    <div class="mt-3" id="copyAlert" style="display: none;" class="alert alert-success">
                        已成功複製到剪貼簿！
                    </div>
                `;

                // 生成並添加每個置換結果
                const fragment = document.createDocumentFragment();
                combinations.forEach((combo, index) => {
                    const replacements = {};
                    for (let key in combo) {
                        replacements[key] = combo[key];
                    }
                    const template = templateTextarea.value;
                    const replaced = replaceTemplate(template, replacements);

                    const card = document.createElement('div');
                    card.className = 'card w-100 p-4 mb-2';

                    const row = document.createElement('div');
                    row.className = 'row';

                    const colText = document.createElement('div');
                    colText.className = 'col-12 mb-2';

                    const textarea = document.createElement('textarea');
                    textarea.className = 'form-control';
                    textarea.readOnly = true;
                    textarea.value = replaced;
                    textarea.rows = 1; // 初始高度，後續autosize會更新
                    colText.appendChild(textarea);

                    const colButton = document.createElement('div');
                    colButton.className = 'col-12 d-flex gap-2';

                    const copyButton = document.createElement('button');
                    copyButton.className = 'btn btn-dark copyButton w-100';
                    copyButton.textContent = '複製';

                    const testButton = document.createElement('button');
                    testButton.className = 'btn btn-dark testButton w-100';
                    testButton.textContent = '測試';

                    colButton.appendChild(copyButton);
                    colButton.appendChild(testButton);

                    row.appendChild(colText);
                    row.appendChild(colButton);
                    card.appendChild(row);

                    fragment.appendChild(card);
                });

                replacementResults.appendChild(fragment);

                const replacementResultsSection = document.getElementById('replacementResultsSection');
                replacementResultsSection.style.display = 'block';

                // 對新生成的 textarea 應用 autosize
                const newTextareas = replacementResults.querySelectorAll('textarea');
                autosize(newTextareas);
                autosize.update(newTextareas);

                // 檢查所有 textarea 是否出現水平捲軸，並調整高度
                newTextareas.forEach(textarea => adjustHeightForScrollbar(textarea));
            });

            // 複製與測試按鈕事件委託
            const replacementResultsContainer = document.getElementById('replacementResults');
            replacementResultsContainer.addEventListener('click', (event) => {
                if (event.target && event.target.classList.contains('copyButton')) {
                    const button = event.target;
                    const textarea = button.closest('.card').querySelector('textarea');
                    textarea.select();
                    textarea.setSelectionRange(0, 99999);
                    document.execCommand('copy');

                    copyAlert.style.display = 'block';
                    setTimeout(() => {
                        copyAlert.style.display = 'none';
                    }, 2000);
                }

                if (event.target && event.target.classList.contains('testButton')) {
                    const button = event.target;
                    const textarea = button.closest('.card').querySelector('textarea');
                    const query = encodeURIComponent(textarea.value);
                    const url = `https://chatgpt.com/?model=gpt-4o&q=${query}`;
                    window.open(url, '_blank');
                }
            });


            // 「產生分享連結」按鈕事件監聽器
            const shareButton = document.getElementById('shareButton');
            const shareLinkTextarea = document.getElementById('shareLinkTextarea');
            const shortShareLinkTextarea = document.getElementById('shortShareLinkTextarea');
            const copyShareLinkButton = document.getElementById('copyShareLinkButton');
            const copyShortShareLinkButton = document.getElementById('copyShortShareLinkTextarea');
            const shareCopyAlert = document.getElementById('shareCopyAlert');

            shareButton.addEventListener('click', () => {
                // 產生一個零寬度字元陣列，將隨機挑一個附加到 name 後面
                const zeroWidthChars = ['\u200B', '\u200C', '\u200D', '\uFEFF'];
                const randomZWC = zeroWidthChars[Math.floor(Math.random() * zeroWidthChars.length)];

                // XSS 防護：確保資料為純文字
                const nameValue = nameInput.value;
                const descriptionValue = descriptionTextarea.value;
                const templateValue = templateTextarea.value;
                const vocabValue = vocabTextarea.value;

                const data = {
                    name: nameValue.trim() + randomZWC, // 在 name 後附加零寬度字元
                    description: descriptionValue.trim(),
                    template: templateValue.trim(),
                    vocab: vocabValue.trim()
                };

                const jsonStr = JSON.stringify(data);
                const base64 = toBase64(jsonStr);

                let searchParams = '';
                if (templateValue.includes('<') && templateValue.includes('>')) {
                    searchParams = '?advance=true';
                }

                const shareURL = `${window.location.origin}${window.location.pathname}${searchParams}#prompt/${base64}`;
                shareLinkTextarea.value = shareURL;

                // 更換目前的網址
                window.history.replaceState(null, '', shareURL);

                const apiKeys = [
                    '4070ff49d794e73714543b663c974755ecd6b036909a04df8a38b58d65165567c4f5d6',
                    '4070ff49d794e73714533b663c974755ecd6b036909904df8a38b58d65165567c4f5d6',
                    '4070ff49d794e73714523b663c974755ecd6b036909804df8a38b58d65165567c4f5d6'
                ];

                const selectedApiKey = apiKeys[Math.floor(Math.random() * apiKeys.length)];

                fetch('https://api.reurl.cc/shorten', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'reurl-api-key': selectedApiKey
                    },
                    body: JSON.stringify({
                        "url": shareLinkTextarea.value,
                        "utm_source": ""
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.res === 'success') {
                            // 將 short_url 寫入 shortShareLinkTextarea
                            shortShareLinkTextarea.value = data.short_url;
                        } else {
                            shortShareLinkTextarea.value = '無法產生短網址';
                        }
                    });

                // 顯示 Modal
                const shareModal = new bootstrap.Modal(document.getElementById('shareModal'));
                shareModal.show();
            });
            copyShareLinkButton.addEventListener('click', () => {
                shareLinkTextarea.select();
                shareLinkTextarea.setSelectionRange(0, 99999);
                document.execCommand('copy');
                shareCopyAlert.style.display = 'block';
                setTimeout(() => {
                    shareCopyAlert.style.display = 'none';
                }, 2000);
            });
            copyShortShareLinkButton.addEventListener('click', () => {
                shortShareLinkTextarea.select();
                shortShareLinkTextarea.setSelectionRange(0, 99999);
                document.execCommand('copy');
                shareCopyAlert.style.display = 'block';
                setTimeout(() => {
                    shareCopyAlert.style.display = 'none';
                }, 2000);
            });
        }

        /**
         * 函數：調整元素高度以避免水平捲軸遮擋最後一行文字
         * @param {HTMLElement} element - 要調整的元素 (textarea 或其他可滾動元素)
         */
        function adjustHeightForScrollbar(element) {
            if (!element) return;
            // 使用 setTimeout 確保在樣式與 autosize 更新後再檢查
            setTimeout(() => {
                // 偵測是否有水平捲軸
                if (element.scrollWidth > element.clientWidth) {
                    // 使用 offsetHeight 取得目前高度
                    const currentHeight = element.offsetHeight;
                    // 增加一些高度，例如增加20px
                    element.style.height = (currentHeight + 20) + 'px';
                }
                // 若無水平捲軸，若有需要也可恢復預設高度（視需求決定是否要執行）
                // else {
                //     element.style.height = null;
                // }
            }, 0);
        }

        /**
         * 當 DOM 內容加載完成後，初始化表單和按鈕
         */
        // 當 DOM 內容加載完成後，初始化表單和按鈕
        document.addEventListener('DOMContentLoaded', () => {
            setupForm();

            // 抓取要套用此功能的元素
            const descriptionTextarea = document.getElementById('descriptionTextarea1');
            const templateTextarea = document.getElementById('templateTextarea1');
            const vocabTextarea = document.getElementById('vocabTextarea1');
            const previewPre = document.querySelector('.preview-box pre');

            // 對指定的元素執行檢查並調整高度
            adjustHeightForScrollbar(descriptionTextarea);
            adjustHeightForScrollbar(templateTextarea);
            adjustHeightForScrollbar(vocabTextarea);
            adjustHeightForScrollbar(previewPre);

            // 監聽進階區域的顯示與隱藏
            const advanceButton = document.getElementById('advanceButton');
            const advanceSection = document.getElementById('advanceSection');

            // 初始化按鈕文字
            advanceButton.textContent = '開啟進階功能';

            // 監聽進階區域的顯示事件
            advanceSection.addEventListener('shown.bs.collapse', () => {
                advanceButton.textContent = '關閉進階功能';
                // 更新 autosize 高度
                autosize.update(document.getElementById('vocabTextarea1'));
                // 調整高度以避免水平捲軸
                adjustHeightForScrollbar(document.getElementById('vocabTextarea1'));
            });

            // 監聽進階區域的隱藏事件
            advanceSection.addEventListener('hidden.bs.collapse', () => {
                advanceButton.textContent = '開啟進階功能';
            });

            // 檢查 URL 參數中是否有 ?advance=true
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('advance') === 'true') {
                // 若為 true，則顯示進階區域
                const bsCollapse = new bootstrap.Collapse(advanceSection, {
                    show: true
                });
            }

            // 添加 hashchange 事件監聽器
            window.addEventListener('hashchange', handleHashChange);
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
        crossorigin="anonymous"></script>

</body>

</html>
